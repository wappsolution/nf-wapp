üìÑ Product Requirements Document (PRD)
Projeto: Conector de Nota Fiscal Eletr√¥nica de Servi√ßo (NFS-e) ‚Äì Prefeitura de S√£o Paulo
Vers√£o: 1.1
Data: 02/07/2025
Respons√°vel: [Seu Nome ou Equipe]

üß≠ 1. Vis√£o Geral
Este projeto visa criar um conector em PHP (CodeIgniter 3) que receba dados de faturamento de um sistema ERP legado e gere Notas Fiscais de Servi√ßo Eletr√¥nicas (NFS-e) para clientes 100% pessoas jur√≠dicas (CNPJ), utilizando o padr√£o exigido pela Prefeitura de S√£o Paulo e a biblioteca open source NFePHP/sped-nfse.

üéØ 2. Objetivos
Automatizar o processo de gera√ß√£o, envio e controle de NFS-e para empresas.

Reduzir erros manuais e garantir conformidade legal com o layout da Prefeitura de S√£o Paulo.

Rastrear o status de cada nota e lote de forma transparente e persistente.

Utilizar tecnologias modernas e de c√≥digo aberto: PHP 7, CodeIgniter 3, Prisma ORM, MySQL e NFePHP.

üß± 3. Escopo
Incluso no escopo:
Endpoint interno RESTful para recep√ß√£o dos dados da nota.

Valida√ß√£o de dados obrigat√≥rios (somente CNPJ).

Gera√ß√£o e assinatura de XML (padr√£o ABRASF/Paulistana).

Envio de XML via WebService SOAP para a Prefeitura de SP.

Armazenamento completo dos dados da nota, status de envio e resposta.

Suporte a envio individual e em lote.

Fora do escopo:
Integra√ß√£o com m√∫ltiplas prefeituras.

Emiss√£o para pessoas f√≠sicas (CPF).

Interface administrativa ou painel visual (neste MVP).

üß© 4. Funcionalidades
Funcionalidade	Descri√ß√£o
Recep√ß√£o de dados (API)	Recebe dados da nota fiscal via JSON com autentica√ß√£o por token.
Valida√ß√£o dos dados	Verifica se todos os campos obrigat√≥rios est√£o presentes e consistentes.
Gera√ß√£o e assinatura XML	Usa o NFePHP para montar o XML e assinar com o certificado digital A1 (.pfx).
Envio ao WebService SP	Envia a nota para a Prefeitura de SP via SOAP.
Registro de status	Armazena status: pendente, enviado, autorizado, rejeitado ou erro.
Armazenamento de XMLs	XML enviado e resposta armazenados no banco para auditoria.
Envio em lote (opcional)	Envio de m√∫ltiplas NFS-e em um mesmo lote, com protocolo.
Consulta e sincronismo	Consulta status de notas por n√∫mero ou protocolo e atualiza estado no banco.